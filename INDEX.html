<!DOCTYPE html>
<html lang="he">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת פגישונים</title>
    <link rel="stylesheet" href="general-pages.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
        }

        .form_c {
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
        }

        .title_c {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .right_f, .left_f {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            font-size: 16px;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .readonly-field input {
            background-color: #e9ecef;
        }

        .hidden-field {
            display: none;
        }

        button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        /* עיצוב מותאם למובייל */
        @media (max-width: 768px) {
            .form_c {
                padding: 15px;
                width: 90%;
            }

            .title_c {
                font-size: 18px;
            }

            input[type="text"], input[type="date"], input[type="time"] {
                font-size: 14px;
            }

            button {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .title_c {
                font-size: 16px;
            }

            input[type="text"], input[type="date"], input[type="time"] {
                font-size: 14px;
            }

            button {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

    <center>
        <div class="form_c">
            <b class="title_c">הדפסת אישור יציאה</b><br><br>

            <form id="exitForm" action="https://pgishonim.netlify.app/confirmation.html" method="GET">
                <div class="form-group">
                    <div class="right_f">תאריך: <input type="date" name="date"></div>
                    <div class="left_f">שעת השחרור: <input type="time" name="release_time"></div>
                </div>

                <div class="form-group">
                    <div class="right_f">שם התלמיד: <input type="text" name="student_name"></div>
                    <div class="left_f">כיתה: <input type="text" name="class"></div>
                </div>

                <div class="form-group">
                    <div class="right_f">סיבה: <input type="text" name="reason"></div>
                </div>

                <!-- הסתרת שדות שלא ניתן לשנות -->
                <div class="hidden-field">
                    <div class="form-group">
                        <div class="right_f">סטטוס: <input type="text" name="status" value="אושר" readonly></div>
                    </div>
                    <div class="form-group">
                        <div class="right_f">מחזוריות: <input type="text" name="frequency" value="חד פעמי" readonly></div>
                    </div>
                    <div class="form-group">
                        <div class="right_f">שעת יציאה: <input type="time" name="exit_time" value="00:00" readonly></div>
                        <div class="left_f">שעת חזרה: <input type="time" name="return_time" value="00:00" readonly></div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="right_f">אושר על ידי: <input type="text" name="approved_by"></div>
                </div>
                

                <div class="gradiant_button blue_torquoise_gradiant">
                    <div class="inner"></div>
                    <button type="submit" style="max-height: 50px;">עדכון יציאה מבית הספר!</button>
                </div>
            </form>
        </div>
    </center>

<!-- START: robust minimal logging -->
<script>
(function(){
  // 1) Simple logger with sendBeacon fallback so navigation doesn't cancel the request
  function send(payload) {
    try {
      const url = "/.netlify/functions/log";
      const json = JSON.stringify(payload);

      // Prefer sendBeacon for fire-and-forget
      if (navigator.sendBeacon) {
        const blob = new Blob([json], { type: "application/json" });
        if (navigator.sendBeacon(url, blob)) return;
      }
      // Fallback to fetch (ignore result)
      fetch(url, {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: json,
        keepalive: true  // helps on page unload
      }).catch(()=>{});
    } catch(e) {
      // swallow
    }
  }

  function meta() {
    return {
      path: location.pathname,
      ref: document.referrer || "",
      lang: navigator.language || "",
      tz: (Intl.DateTimeFormat().resolvedOptions().timeZone || ""),
      screen: (window.screen && screen.width && screen.height) ? (screen.width + "x" + screen.height) : ""
    };
  }

  // 2) Log once when DOM is ready
  function logViewOnce() {
    if (window.__logged_view__) return;
    window.__logged_view__ = true;
    const m = meta();
    send({ type: "view", path: m.path, ref: m.ref, lang: m.lang, tz: m.tz, screen: m.screen });
  }
  if (document.readyState === "complete" || document.readyState === "interactive") {
    logViewOnce();
  } else {
    document.addEventListener("DOMContentLoaded", logViewOnce, { once: true });
  }

  // 3) Log form submit reliably
  function hookForm() {
    const form = document.getElementById("exitForm") || document.querySelector("form");
    if (!form) return;

    form.addEventListener("submit", function(){
      try {
        const fd = new FormData(form);
        const obj = {};
        for (const [k,v] of fd.entries()) obj[k] = v;
        send({ type: "submit", data: obj, ...meta() });
      } catch(e) {}
    }, true);
  }
  hookForm();

  // 4) As a last resort, also log right before the page becomes hidden
  document.addEventListener("visibilitychange", function(){
    if (document.visibilityState === "hidden") {
      send({ type: "ping", ...meta() });
    }
  });
})();
</script>
<!-- END: robust minimal logging -->



</body>


</html>
